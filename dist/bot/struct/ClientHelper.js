"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _toConsumableArray2=require("babel-runtime/helpers/toConsumableArray");var _toConsumableArray3=_interopRequireDefault(_toConsumableArray2);var _set=require("babel-runtime/core-js/set");var _set2=_interopRequireDefault(_set);var _from=require("babel-runtime/core-js/array/from");var _from2=_interopRequireDefault(_from);var _slicedToArray2=require("babel-runtime/helpers/slicedToArray");var _slicedToArray3=_interopRequireDefault(_slicedToArray2);var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _discord=require("discord.js");var _FrameworkError=require("../../common/classes/discord/FrameworkError");var _Constants=require("../../common/deps/Constants");var _lodash=require("lodash");var _=_interopRequireWildcard(_lodash);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ClientHelper;exports.default=ClientHelper=function(){function ClientHelper(client){(0,_classCallCheck3.default)(this,ClientHelper);this.client=client}(0,_createClass3.default)(ClientHelper,[{key:"resolve_user",value:function resolve_user(potential){var users=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.client.users;var cs=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var wm=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;return users.find(function(e){return this.check_user(potential,e,cs,wm)})}},{key:"resolve_users",value:function resolve_users(potential){var users=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.client.users;var cs=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var wm=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;return users.filter(function(e){return this.check_user(potential,e,cs,wm)})}},{key:"resolve_member",value:function resolve_member(potential,members){var cs=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var wm=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;return members.find(function(e){return this.check_user(potential,e.user,cs,wm,e.nickname)})}},{key:"resolve_members",value:function resolve_members(potential,members){var cs=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var wm=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;return members.filter(function(e){return this.check_user(potential,e.user,cs,wm,e.nickname)})}},{key:"potentialreg",value:function potentialreg(potential,whole_word,case_sensitive){if(!whole_word){return new new RegExp(_.escapeRegExp(potential),case_sensitive?"i":void 0)}else{return new RegExp("^"+_.escapeRegExp(potential)+"$",case_sensitive?"i":void 0)}}},{key:"check_user",value:function check_user(potential,user){var case_sensitive=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var whole_word=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var nickname=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"";var discrim,match,potentialreg,ref,tag,username;if(!user){throw new _FrameworkError.FrameworkError("BAD_ARGUMENT","No user given to match")}if(!"id"in user){throw new _FrameworkError.FrameworkError("BAD_ARGUMENT","Invalid User object given (no id)")}match=potential.match(_Constants.DiscordConstants.MENTION.USER_MENTION);if(match!=null&&user.id===match[1]){return true}potentialreg=this.potentialreg(potential,whole_word,case_sensitive);tag=user.tag;username=user.username;discrim=user.discrim;return Boolean(tag.match(potentialreg)||username.match(potentialreg)||(0<(ref=potential.length)&&ref<5?discrim.match(potentialreg):void 0)||(nickname&&nickname.length>0?nickname.match(potentialreg):void 0))}},{key:"resolve_u_order",value:function resolve_u_order(potential){var users=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.client.users;var multiple=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var type=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"user";return[[1,1],[1,0],[0,1],[]].map(function(e){return this["resolve_"+type+(multiple?"s":"")](potential,users,!!e[0],!!e[1])})}},{key:"resolve_user_best",value:function resolve_user_best(potential){var users=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.client.users;var a,b,c,d,ref,ref1;var _resolve_u_order=this.resolve_u_order(potential,users);var _resolve_u_order2=(0,_slicedToArray3.default)(_resolve_u_order,4);a=_resolve_u_order2[0];b=_resolve_u_order2[1];c=_resolve_u_order2[2];d=_resolve_u_order2[3];return(ref=(ref1=a!=null?a:b)!=null?ref1:c)!=null?ref:d}},{key:"resolve_member_best",value:function resolve_member_best(potential,members){var a,b,c,d,ref,ref1;var _resolve_u_order3=this.resolve_u_order(potential,users,false,"member");var _resolve_u_order4=(0,_slicedToArray3.default)(_resolve_u_order3,4);a=_resolve_u_order4[0];b=_resolve_u_order4[1];c=_resolve_u_order4[2];d=_resolve_u_order4[3];return(ref=(ref1=a!=null?a:b)!=null?ref1:c)!=null?ref:d}},{key:"resolve_users_best",value:function resolve_users_best(potential){var users=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.client.users;var a,b,c,d;var _resolve_u_order$map=this.resolve_u_order(potential,users,true).map(function(e){return(0,_from2.default)(e.keys())});var _resolve_u_order$map2=(0,_slicedToArray3.default)(_resolve_u_order$map,4);a=_resolve_u_order$map2[0];b=_resolve_u_order$map2[1];c=_resolve_u_order$map2[2];d=_resolve_u_order$map2[3];return(0,_from2.default)(new _set2.default([].concat((0,_toConsumableArray3.default)(a),(0,_toConsumableArray3.default)(b),(0,_toConsumableArray3.default)(c),(0,_toConsumableArray3.default)(d)).map(users.get.bind(users))))}},{key:"resolve_members_best",value:function resolve_members_best(potential,members){var a,b,c,d;var _resolve_u_order$map3=this.resolve_u_order(potential,members,true,"member").map(function(e){return(0,_from2.default)(e.keys())});var _resolve_u_order$map4=(0,_slicedToArray3.default)(_resolve_u_order$map3,4);a=_resolve_u_order$map4[0];b=_resolve_u_order$map4[1];c=_resolve_u_order$map4[2];d=_resolve_u_order$map4[3];return(0,_from2.default)(new _set2.default([].concat((0,_toConsumableArray3.default)(a),(0,_toConsumableArray3.default)(b),(0,_toConsumableArray3.default)(c),(0,_toConsumableArray3.default)(d)).map(members.get.bind(members))))}},{key:"check_channel",value:function check_channel(potential,channel){var case_sensitive=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var whole_word=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var match,name,ref,textreg;if(!channel){throw new _FrameworkError.FrameworkError("BAD_ARGUMENT","No channel given to match")}if(!"id"in user){throw new _FrameworkError.FrameworkError("BAD_ARGUMENT","Invalid Channel object given (no id)")}match=potential.match(_Constants.DiscordConstants.MENTION.CHANNEL_MENTION);if(match!=null&&channel.id===match[1]){return true}textreg=this.potentialreg(potential,whole_word,case_sensitive);name=channel.name;return Boolean(name.match(textreg)||username.match(textreg)||(0<(ref=potential.length)&&ref<5?discrim.match(textreg):void 0)||(nickname&&nickname.length>0?nickname.match(textreg):void 0))}}]);return ClientHelper}();