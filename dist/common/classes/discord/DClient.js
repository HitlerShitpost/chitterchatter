"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _promise=require("babel-runtime/core-js/promise");var _promise2=_interopRequireDefault(_promise);var _defineProperties=require("babel-runtime/core-js/object/define-properties");var _defineProperties2=_interopRequireDefault(_defineProperties);var _getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of");var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn");var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require("babel-runtime/helpers/inherits");var _inherits3=_interopRequireDefault(_inherits2);var _discord=require("discord.js");var _discord2=_interopRequireDefault(_discord);var _path=require("path");var _path2=_interopRequireDefault(_path);var _ClientError=require("./ClientError");var _ClientError2=_interopRequireDefault(_ClientError);var _classWrap=require("../../deps/functions/classWrap");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var DClient;exports.default=DClient=(0,_classWrap.wrap)(DClient=function(){var __init__,_login,_setup_handlers,build,load_all;var DClient=function(_wrap){(0,_inherits3.default)(DClient,_wrap);function DClient(){var _ref;(0,_classCallCheck3.default)(this,DClient);for(var _len=arguments.length,opts=Array(_len),_key=0;_key<_len;_key++){opts[_key]=arguments[_key]}var _this=(0,_possibleConstructorReturn3.default)(this,(_ref=DClient.__proto__||(0,_getPrototypeOf2.default)(DClient)).call.apply(_ref,[this].concat(opts)));_this._setup_handlers=_setup_handlers.bind(_this);_this.build=build.bind(_this);_this.load_all=load_all.bind(_this);_this._login=_login.bind(_this);__init__.bind(_this).apply(undefined,opts);_this.constructor.prototype.__init__=__init__;return _this}return DClient}((0,_classWrap.wrap)(_discord2.default.Client));__init__=function __init__(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var ref;this.store_cmd_msgs=!!options.store_cmd_msgs;this.cwd=process.cwd();this.owner_ids="ownerid"in options?[options.owner_id]:(ref=options.owner_ids)!=null?ref:[];this._built=this._loaded=false;return(0,_defineProperties2.default)(this,{_options:{value:options,configurable:true}})};_setup_handlers=function _setup_handlers(){var force=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this._built&&!force){throw new _ClientError2.default("BUILD_ONCE")}};build=function build(){var force=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this._built&&!force){throw new _ClientError2.default("BUILD_ONCE")}return this._setup_handlers(force)};load_all=function load_all(){var force=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this._loaded&&!force){throw new _ClientError2.default("LOAD_ONCE")}this._loaded=true;if(this.event_handler){this.event_handler.load_all()}if(this.command_handler){this.command_handler.load_all()}if(this.inhibitor_handler){this.inhibitor_handler.load_all()}return this};_login=function _login(token){var _this2=this;return new _promise2.default(function(res,rej){var err;if(!_this2._built){_this2.build()}if(!_this2._loaded){_this2.load_all()}try{return res(_this2.login(token))}catch(error){err=error;return rej(err)}})};return DClient}());